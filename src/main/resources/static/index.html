<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <button onclick="getProductInfo()">결제경험해보기</button>


    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>

    <script>

        // TODO:
        // 아래 코드가 클라이언트 쪽 javascript 나 node.js 에 있어야함!
        // gateway 쪽으로 요청오면 그게 라우팅 되서 > pamyent 로 온다!
        // pamynet에서 product로 정보 요청한다음 성공하면 그 정보 가지고 결제창 띄우기
        function getProductInfo() {
            // apigateway 쪽으로 요청
            fetch('/api/product', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    orderId: 'order_no_0001',
                    amount: 1004,
                    buyerEmail: 'test@portone.io',
                    buyerName: '구매자이름',
                    buyerTel: '010-1234-5678'
                })
            })
                .then(response => response.json())
                .then(data => {
                    // 백엔드에서 gRPC 호출이 성공했다면, 결제 창을 띄움
                    if (data.success) {
                        requestPay(data.paymentId);
                    } else {
                        console.error('결제 요청 실패:', data.message);
                    }
                })
                .catch(error => {
                    console.error('결제 요청 중 오류 발생:', error);
                });
        }


        function requestPay() {

            IMP.request_pay(
                {
                    pg: "html5_inicis.INIpayTest",
                    pay_method: "card",
                    merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
                    name: "주문명:결제테스트",
                    amount: 1004,
                    buyer_email: "test@portone.io",
                    buyer_name: "구매자이름",
                    buyer_tel: "010-1234-5678", //필수 파라미터 입니다.
                    buyer_addr: "서울특별시 강남구 삼성동",
                    buyer_postcode: "123-456",
                    // m_redirect_url: "{모바일에서 결제 완료 후 리디렉션 될 URL}",
                    escrow: true, //에스크로 결제인 경우 설정
                    vbank_due: "YYYYMMDD",
                    notice_url: "https://bowmeownotice.store-69f03025-fc9a-4f6a-a044-524da019d0a7",
                    bypass: {
                        // PC 경우
                        acceptmethod: "noeasypay", // 간편결제 버튼을 통합결제창에서 제외(PC)
                        // acceptmethod: "cardpoint", // 카드포인트 사용시 설정(PC)4
                        // 모바일 경우
                        P_RESERVED: "noeasypay=Y", // 간편결제 버튼을 통합결제창에서 제외(모바일)
                        // P_RESERVED: "cp_yn=Y", // 카드포인트 사용시 설정(모바일)
                        // P_RESERVED: "twotrs_bank=Y&iosapp=Y&app_scheme=your_app_scheme://", // iOS에서 계좌이체시 결제가 이뤄지던 앱으로 돌아가기
                    },
                    period: {
                        from: "20240801", //YYYYMMDD
                        to: "20240802", //YYYYMMDD
                    },
                },
                function (rsp) {
                    // callback 로직
                    //* ...중략... *//
                },
            );
        }
    </script>

</body>
</html>